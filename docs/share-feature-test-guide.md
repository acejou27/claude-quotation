# 分享功能測試指南

## 目的
本指南協助您測試報價單分享功能，確保所有流程正常運作。

## 前置準備

### 1. 環境確認
```bash
# 確認開發伺服器正在運行
pnpm dev

# 檢查資料庫連線
echo $DATABASE_URL
```

### 2. 測試帳號
- 確保您已登入系統
- 至少有一個報價單可供測試

## 測試步驟

### 測試 1：首次生成分享連結

#### 步驟
1. 登入系統並進入報價單列表頁面
   - URL: `http://localhost:3000/zh/quotations`

2. 選擇任一報價單，點擊「檢視」進入詳情頁
   - URL 格式: `http://localhost:3000/zh/quotations/[報價單ID]`

3. 在詳情頁面右上角找到「分享」按鈕（紫色按鈕，有分享圖示）

4. 點擊「分享」按鈕

5. 觀察對話框是否正常顯示

6. 檢查對話框內容：
   - ✓ 標題顯示「分享報價單」
   - ✓ 說明文字顯示
   - ✓ 顯示「生成分享連結」按鈕

7. 點擊「生成分享連結」按鈕

8. 等待載入（應該會看到轉圈動畫）

9. 檢查生成結果：
   - ✓ 顯示分享連結輸入框
   - ✓ 連結格式正確（`http://localhost:3000/share/[12字元token]`）
   - ✓ 顯示「複製」按鈕
   - ✓ 顯示查看次數（應為 0）
   - ✓ 顯示「停用分享連結」按鈕

#### 預期結果
✓ 所有步驟都能順利完成，沒有錯誤訊息

---

### 測試 2：複製分享連結

#### 步驟
1. 在分享對話框中，找到「複製」按鈕

2. 點擊「複製」按鈕

3. 觀察按鈕變化：
   - ✓ 按鈕文字變更為「已複製」
   - ✓ 按鈕顯示勾選圖示

4. 等待 2 秒

5. 確認按鈕恢復為「複製」

6. 開啟文字編輯器或記事本

7. 按下 Cmd+V (Mac) 或 Ctrl+V (Windows) 貼上

8. 確認連結已成功複製

#### 預期結果
✓ 連結成功複製到剪貼簿
✓ 按鈕狀態正確切換

---

### 測試 3：查看現有分享連結

#### 步驟
1. 關閉分享對話框（點擊背景或「取消」按鈕）

2. 重新點擊「分享」按鈕

3. 檢查對話框內容：
   - ✓ 不需要點擊「生成分享連結」
   - ✓ 直接顯示之前生成的連結
   - ✓ 連結與之前相同
   - ✓ 顯示查看次數和統計資訊

#### 預期結果
✓ 系統記住之前的分享狀態
✓ 不會重複生成新連結

---

### 測試 4：訪問分享連結

#### 步驟
1. 複製分享連結

2. 開啟無痕視窗（隱私模式）
   - Chrome: Cmd+Shift+N (Mac) 或 Ctrl+Shift+N (Windows)
   - Safari: Cmd+Shift+N
   - Firefox: Cmd+Shift+P 或 Ctrl+Shift+P

3. 在無痕視窗中貼上分享連結並前往

4. 檢查分享頁面載入：
   - ✓ 頁面正常載入，無需登入
   - ✓ 顯示「報價單」標題
   - ✓ 顯示語言切換按鈕（中文/English）

5. 檢查報價單資訊：
   - ✓ 顯示報價單編號
   - ✓ 顯示建立日期
   - ✓ 顯示狀態徽章
   - ✓ 顯示客戶資訊（名稱、Email、電話等）
   - ✓ 顯示報價單詳情（有效期限、幣別、稅率）

6. 檢查產品項目：
   - ✓ 產品表格正常顯示
   - ✓ 顯示產品名稱、數量、單價、折扣、小計
   - ✓ 底部顯示小計、稅額、總計

7. 檢查備註（如果有）：
   - ✓ 備註區塊正常顯示

8. 測試語言切換：
   - ✓ 點擊「English」按鈕
   - ✓ 確認內容切換為英文
   - ✓ 客戶名稱變更為英文版
   - ✓ 產品名稱變更為英文版
   - ✓ UI 標籤變更為英文
   - ✓ 日期格式變更為英文格式

9. 切回中文：
   - ✓ 點擊「中文」按鈕
   - ✓ 確認內容切換回中文

#### 預期結果
✓ 無需登入即可查看完整報價單
✓ 所有資訊正確顯示
✓ 語言切換功能正常

---

### 測試 5：查看統計更新

#### 步驟
1. 訪問分享連結後（使用無痕視窗）

2. 回到原登入視窗

3. 重新開啟分享對話框

4. 檢查統計資訊：
   - ✓ 查看次數增加（應為 1 或更多）
   - ✓ 顯示「最後查看」時間
   - ✓ 時間接近當前時間

#### 預期結果
✓ 查看統計正確更新
✓ 最後查看時間正確記錄

---

### 測試 6：停用分享連結

#### 步驟
1. 在分享對話框中，點擊「停用分享連結」按鈕

2. 等待載入

3. 檢查對話框變化：
   - ✓ 連結消失
   - ✓ 顯示「生成分享連結」按鈕
   - ✓ 統計資訊消失

4. 開啟無痕視窗

5. 嘗試訪問之前的分享連結

6. 確認結果：
   - ✓ 顯示 404 錯誤頁面
   - ✓ 或顯示「找不到此報價單」訊息

#### 預期結果
✓ 分享連結成功停用
✓ 停用後的連結無法訪問

---

### 測試 7：重新生成分享連結

#### 步驟
1. 在停用連結後，點擊「生成分享連結」

2. 檢查新連結：
   - ✓ 生成新的 token
   - ✓ 新連結與之前不同
   - ✓ 查看次數重置為 0

3. 訪問新連結

4. 確認可以正常查看

#### 預期結果
✓ 可以重新生成新連結
✓ 新連結正常運作

---

### 測試 8：多瀏覽器測試

#### 步驟
1. 在不同瀏覽器中開啟分享連結：
   - Chrome
   - Safari
   - Firefox
   - Edge（如果是 Windows）

2. 檢查每個瀏覽器中：
   - ✓ 頁面正常顯示
   - ✓ 語言切換功能正常
   - ✓ 樣式正確載入
   - ✓ 無 JavaScript 錯誤（開啟開發者工具檢查）

#### 預期結果
✓ 在所有瀏覽器中都能正常運作

---

### 測試 9：行動裝置測試

#### 步驟
1. 在手機或平板上開啟分享連結

2. 或使用瀏覽器開發者工具的行動裝置模擬：
   - Chrome: F12 → 點擊手機圖示
   - Safari: Cmd+Opt+I → Develop → Enter Responsive Design Mode

3. 檢查響應式設計：
   - ✓ 頁面自動調整版面
   - ✓ 文字大小適當
   - ✓ 按鈕可以點擊
   - ✓ 表格可以滾動
   - ✓ 語言切換按鈕正常運作

#### 預期結果
✓ 在行動裝置上顯示正常
✓ 所有功能可以正常使用

---

### 測試 10：錯誤處理

#### 步驟

**測試 10.1: 無效的 Token**
1. 手動修改分享連結的 token
   - 範例: `http://localhost:3000/share/invalid12345`
2. 訪問修改後的連結
3. 確認顯示 404 錯誤頁面

**測試 10.2: 過期的連結（如果有設定過期時間）**
1. 生成有過期時間的分享連結（需要修改 POST API 的參數）
2. 等待過期或手動修改資料庫
3. 訪問連結
4. 確認顯示錯誤訊息

**測試 10.3: 已停用的連結**
1. 生成分享連結
2. 停用連結
3. 訪問連結
4. 確認顯示 404 錯誤

**測試 10.4: 網路錯誤**
1. 開啟開發者工具
2. 切換到 Network 標籤
3. 啟用「Offline」模式
4. 嘗試生成分享連結
5. 確認顯示錯誤訊息

#### 預期結果
✓ 所有錯誤情況都有適當的錯誤訊息
✓ 不會顯示技術性錯誤細節給用戶

---

## 測試檢查清單

請在完成每項測試後打勾：

- [ ] 測試 1：首次生成分享連結
- [ ] 測試 2：複製分享連結
- [ ] 測試 3：查看現有分享連結
- [ ] 測試 4：訪問分享連結
- [ ] 測試 5：查看統計更新
- [ ] 測試 6：停用分享連結
- [ ] 測試 7：重新生成分享連結
- [ ] 測試 8：多瀏覽器測試
- [ ] 測試 9：行動裝置測試
- [ ] 測試 10：錯誤處理

## 常見問題排查

### 問題：點擊分享按鈕沒有反應
**檢查：**
1. 開啟瀏覽器開發者工具（F12）
2. 查看 Console 標籤是否有錯誤訊息
3. 檢查網路請求是否成功（Network 標籤）
4. 確認已正確登入

### 問題：生成分享連結失敗
**檢查：**
1. 檢查 Network 標籤中的 API 回應
2. 確認資料庫連線正常
3. 檢查報價單是否屬於當前用戶

### 問題：分享頁面顯示不完整
**檢查：**
1. 開啟開發者工具檢查 Console 錯誤
2. 確認資料庫中有完整的客戶和產品資料
3. 檢查 JSONB 欄位格式是否正確

### 問題：語言切換無效
**檢查：**
1. 確認客戶和產品的 name、address、description 欄位是 JSONB 格式
2. 範例格式：`{"zh": "中文內容", "en": "English Content"}`

## 測試報告

完成所有測試後，請記錄：

### 測試環境
- 日期：________________
- 瀏覽器：________________
- 作業系統：________________
- Node.js 版本：________________
- 資料庫：________________

### 測試結果
- 通過測試：____ / 10
- 失敗測試：____
- 發現的問題：

1. ________________________________
2. ________________________________
3. ________________________________

### 建議改進
1. ________________________________
2. ________________________________
3. ________________________________

---

**測試完成後，請將結果回報給開發團隊。**

需要協助？請查看以下文件：
- 技術文件：`docs/share-feature-test-report.md`
- API 文件：`app/api/quotations/[id]/share/route.ts`
- 組件文件：`components/ShareButton.tsx`
