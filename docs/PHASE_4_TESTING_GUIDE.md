# Phase 4: 超級管理員控制台測試指南

本文件提供 Phase 4 (超級管理員控制台 UI) 的完整測試指南。

## 📋 測試前準備

### 1. 確認環境

```bash
# 確認開發伺服器正在運行
npm run dev

# 確認資料庫連線正常
# 應該能在 http://localhost:3000 看到應用程式
```

### 2. 確認測試帳號

- **超級管理員帳號**: acejou27@gmail.com
- 確保該帳號在資料庫中有 `super_admin` 角色

### 3. 編譯檢查

```bash
# 執行 TypeScript 編譯檢查
npx tsc --noEmit --project .

# 確認 admin 相關檔案沒有錯誤
npx tsc --noEmit --project . 2>&1 | grep -i "admin" | grep -iE "error TS"
# 應該沒有輸出
```

---

## 🧪 Phase 4.1: 管理員佈局與導航測試

### 檔案清單
- ✅ `app/admin/layout.tsx` - 管理員佈局
- ✅ `components/admin/AdminHeader.tsx` - 頁首組件
- ✅ `components/admin/AdminSidebar.tsx` - 側邊導航

### 測試步驟

#### 1. 存取控制測試

**測試 1.1: 未登入存取**
1. 確保已登出
2. 瀏覽器輸入: `http://localhost:3000/admin`
3. **預期結果**: 自動重定向到 `/login?redirect=/admin`

**測試 1.2: 一般使用者存取**
1. 使用非超管帳號登入
2. 瀏覽器輸入: `http://localhost:3000/admin`
3. **預期結果**: 自動重定向到 `/?error=unauthorized`

**測試 1.3: 超級管理員存取**
1. 使用 `acejou27@gmail.com` 登入
2. 瀏覽器輸入: `http://localhost:3000/admin`
3. **預期結果**: 成功顯示管理員儀表板

#### 2. 頁首測試

**測試 2.1: 頁首顯示**
- [ ] 顯示「超級管理員控制台」標題
- [ ] 顯示「Super Admin」標籤
- [ ] 顯示使用者資訊
- [ ] 顯示登出按鈕

**測試 2.2: 登出功能**
1. 點擊「登出」按鈕
2. **預期結果**:
   - 成功登出
   - 重定向到 `/login`

#### 3. 側邊導航測試

**測試 3.1: 導航項目顯示**
- [ ] 🏠 儀表板 (`/admin`)
- [ ] 🏢 公司管理 (`/admin/companies`)
- [ ] 👥 使用者管理 (`/admin/users`)
- [ ] 🛡️ 權限管理 (`/admin/permissions`)
- [ ] 📊 系統統計 (`/admin/analytics`)
- [ ] ⚙️ 系統設定 (`/admin/settings`)

**測試 3.2: 導航功能**
1. 點擊每個導航項目
2. **預期結果**: URL 正確切換，對應頁面顯示

**測試 3.3: 活躍狀態指示**
1. 點擊不同導航項目
2. **預期結果**: 當前頁面的導航項目有紫色背景高亮

**測試 3.4: 快速資訊區**
- [ ] 顯示「系統版本: v1.0.0」
- [ ] 顯示「環境: 開發」

**測試 3.5: 輔助連結**
- [ ] 「說明文件」連結到 `/admin/help`
- [ ] 「返回主系統」連結到 `/`

---

## 🧪 Phase 4.2: 超級管理員儀表板測試

### 檔案清單
- ✅ `app/admin/page.tsx` - 儀表板頁面
- ✅ `app/api/admin/stats/route.ts` - 統計 API
- ✅ `hooks/admin/useAdminStats.ts` - 統計 Hook

### 測試步驟

#### 1. API 測試

**測試 1.1: 統計 API**
```bash
# 使用 curl 測試（需先在瀏覽器登入以獲得 cookie）
curl http://localhost:3000/api/admin/stats \
  -H "Cookie: [從瀏覽器複製的 cookie]"
```

**預期回應格式**:
```json
{
  "success": true,
  "stats": {
    "overview": {
      "totalCompanies": 5,
      "totalUsers": 20,
      "activeCompanies": 4,
      "totalMembers": 15
    },
    "recent": {
      "newCompanies": 2,
      "newUsers": 5
    },
    "roles": [
      {
        "role_name": "company_owner",
        "display_name": "公司擁有者",
        "count": 5
      }
    ]
  }
}
```

#### 2. 儀表板頁面測試

**測試 2.1: 載入狀態**
1. 重新整理頁面
2. **預期結果**: 顯示載入動畫

**測試 2.2: 統計卡片**
- [ ] 公司總數卡片
  - 顯示總數
  - 顯示活躍公司數
- [ ] 使用者總數卡片
  - 顯示總數
  - 顯示成員數
- [ ] 新增公司卡片
  - 顯示最近 7 天新增數
- [ ] 新增使用者卡片
  - 顯示最近 7 天新增數

**測試 2.3: 角色分布**
- [ ] 顯示各角色名稱
- [ ] 顯示各角色數量
- [ ] 排序正確

**測試 2.4: 快速操作連結**
1. 點擊「🏢 公司管理」
   - **預期**: 導向 `/admin/companies`
2. 點擊「👥 使用者管理」
   - **預期**: 導向 `/admin/users`
3. 點擊「🛡️ 權限管理」
   - **預期**: 導向 `/admin/permissions`

---

## 🧪 Phase 4.3: 公司管理頁面測試

### 檔案清單
- ✅ `app/admin/companies/page.tsx` - 公司列表頁
- ✅ `app/admin/companies/[id]/page.tsx` - 公司詳情頁
- ✅ `hooks/admin/useAdminCompanies.ts` - 公司列表 Hook
- ✅ `hooks/admin/useAdminCompanyDetail.ts` - 公司詳情 Hook

### 測試步驟

#### 1. 公司列表頁測試

**測試 1.1: 統計卡片**
- [ ] 公司總數
- [ ] 活躍公司數
- [ ] 非活躍公司數
- [ ] 成員總數

**測試 1.2: 搜尋功能**
1. 在搜尋框輸入公司名稱
2. **預期結果**: 即時篩選符合的公司
3. 測試搜尋項目:
   - 公司名稱
   - 統編
   - Email

**測試 1.3: 狀態篩選**
1. 點擊「全部」按鈕
   - **預期**: 顯示所有公司
2. 點擊「活躍」按鈕
   - **預期**: 只顯示活躍公司
3. 點擊「非活躍」按鈕
   - **預期**: 只顯示非活躍公司

**測試 1.4: 公司列表顯示**
表格應顯示:
- [ ] 公司名稱、統編、Email
- [ ] 擁有者名稱和 Email
- [ ] 成員數量
- [ ] 狀態標籤（活躍/非活躍）
- [ ] 建立時間
- [ ] 「查看詳情」連結

**測試 1.5: 排序與分頁**
- [ ] 結果統計顯示正確（如「顯示 5 / 10 間公司」）

#### 2. 公司詳情頁測試

**測試 2.1: 導航**
1. 從列表頁點擊任一公司的「查看詳情」
2. **預期結果**: 導向該公司詳情頁

**測試 2.2: 頁面顯示**
- [ ] 顯示返回按鈕
- [ ] 顯示公司名稱標題
- [ ] 顯示狀態標籤

**測試 2.3: 統計卡片**
- [ ] 成員總數
- [ ] 活躍成員數
- [ ] 建立時間

**測試 2.4: 基本資訊區塊**
- [ ] 公司名稱
- [ ] 統一編號
- [ ] 公司 Email
- [ ] 聯絡電話
- [ ] 公司地址
- [ ] 公司網站（可點擊，開新分頁）

**測試 2.5: 擁有者資訊**
- [ ] 顯示擁有者頭像/首字母
- [ ] 顯示擁有者名稱
- [ ] 顯示擁有者 Email

**測試 2.6: 成員列表**
表格應顯示:
- [ ] 成員頭像/首字母
- [ ] 成員名稱和 Email
- [ ] 角色標籤
- [ ] 加入時間
- [ ] 狀態（活躍/非活躍）

**測試 2.7: 返回功能**
1. 點擊頁面底部「返回公司列表」按鈕
2. **預期結果**: 返回 `/admin/companies`

---

## 🧪 Phase 4.4: 使用者管理頁面測試

### 檔案清單
- ✅ `app/admin/users/page.tsx` - 使用者列表頁
- ✅ `app/admin/users/[id]/page.tsx` - 使用者詳情頁
- ✅ `hooks/admin/useAdminUsers.ts` - 使用者列表 Hook
- ✅ `hooks/admin/useAdminUserDetail.ts` - 使用者詳情 Hook

### 測試步驟

#### 1. 使用者列表頁測試

**測試 1.1: 統計卡片**
- [ ] 使用者總數
- [ ] 超級管理員數量
- [ ] 已加入公司的使用者數
- [ ] 未加入公司的使用者數

**測試 1.2: 搜尋功能**
1. 在搜尋框輸入關鍵字
2. **預期結果**: 即時篩選符合的使用者
3. 測試搜尋項目:
   - 使用者名稱
   - Email
   - 公司名稱

**測試 1.3: 角色篩選**
1. 從下拉選單選擇角色
2. **預期結果**: 只顯示擁有該角色的使用者

**測試 1.4: 使用者列表顯示**
表格應顯示:
- [ ] 使用者頭像/首字母
- [ ] 使用者名稱和 Email
- [ ] Super Admin 標籤（如適用）
- [ ] 角色標籤（可能有多個）
- [ ] 所屬公司列表（含角色）
- [ ] 註冊時間
- [ ] 「查看詳情」連結

**測試 1.5: 公司連結**
1. 點擊使用者所屬公司的連結
2. **預期結果**: 導向該公司詳情頁

#### 2. 使用者詳情頁測試

**測試 2.1: 導航**
1. 從列表頁點擊任一使用者的「查看詳情」
2. **預期結果**: 導向該使用者詳情頁

**測試 2.2: 頁面顯示**
- [ ] 顯示返回按鈕
- [ ] 顯示使用者名稱/Email 作為標題
- [ ] 顯示 Super Admin 標籤（如適用）

**測試 2.3: 統計卡片**
- [ ] 角色數量
- [ ] 所屬公司數量
- [ ] 註冊時間

**測試 2.4: 基本資訊區塊**
- [ ] 顯示頭像/首字母
- [ ] 使用者姓名
- [ ] Email
- [ ] User ID (monospace 字體)
- [ ] 最後更新時間

**測試 2.5: 系統角色區塊**
- [ ] 顯示所有系統角色
- [ ] 每個角色顯示:
  - 角色顯示名稱
  - 角色內部名稱 (monospace)
  - 圖示

**測試 2.6: 公司成員關係表格**
表格應顯示:
- [ ] 公司名稱
- [ ] 公司角色標籤
- [ ] 加入時間
- [ ] 狀態（活躍/非活躍）
- [ ] 「查看公司」連結

**測試 2.7: 公司連結**
1. 點擊任一公司的「查看公司」連結
2. **預期結果**: 導向該公司詳情頁

**測試 2.8: 返回功能**
1. 點擊頁面底部「返回使用者列表」按鈕
2. **預期結果**: 返回 `/admin/users`

---

## 🔒 安全性測試

### 1. 路由保護

**測試 1.1: 直接 URL 存取**
測試以下 URL，確保非超管無法存取:
- `http://localhost:3000/admin`
- `http://localhost:3000/admin/companies`
- `http://localhost:3000/admin/users`
- `http://localhost:3000/admin/companies/[any-id]`
- `http://localhost:3000/admin/users/[any-id]`

**測試 1.2: API 端點保護**
使用一般使用者的 cookie 測試:
```bash
curl http://localhost:3000/api/admin/stats -H "Cookie: [一般使用者 cookie]"
curl http://localhost:3000/api/admin/companies -H "Cookie: [一般使用者 cookie]"
curl http://localhost:3000/api/admin/users -H "Cookie: [一般使用者 cookie]"
```

**預期結果**: 應返回 403 Forbidden

### 2. 資料隔離

**測試 2.1: 跨公司資料存取**
1. 以超管身份查看不同公司的資料
2. **預期結果**: 可以看到所有公司的資料
3. 確認資料不會混淆

---

## 📱 響應式設計測試

### 測試裝置尺寸

1. **桌面 (1920x1080)**
   - [ ] 側邊欄完整顯示
   - [ ] 統計卡片 4 列排列
   - [ ] 表格完整顯示

2. **平板 (768x1024)**
   - [ ] 統計卡片 2 列排列
   - [ ] 表格可橫向滾動
   - [ ] 搜尋與篩選垂直排列

3. **手機 (375x667)**
   - [ ] 統計卡片 1 列排列
   - [ ] 表格可橫向滾動
   - [ ] 搜尋框全寬
   - [ ] 按鈕垂直排列

---

## ⚡ 效能測試

### 1. 頁面載入速度

測試項目:
- [ ] 儀表板初始載入 < 2 秒
- [ ] 公司列表載入 < 2 秒
- [ ] 使用者列表載入 < 2 秒
- [ ] 詳情頁載入 < 1 秒

### 2. 搜尋與篩選效能

測試項目:
- [ ] 搜尋輸入無延遲
- [ ] 篩選切換即時響應
- [ ] 大量資料（100+ 筆）時仍順暢

---

## 🎨 UI/UX 測試

### 1. 一致性檢查

- [ ] 所有卡片使用相同的樣式
- [ ] 按鈕樣式一致
- [ ] 顏色使用一致（紫色主題）
- [ ] 間距統一
- [ ] 字型大小階層清晰

### 2. 互動回饋

- [ ] 按鈕 hover 效果
- [ ] 連結 hover 效果
- [ ] 表格行 hover 效果
- [ ] 載入狀態顯示
- [ ] 錯誤訊息顯示

### 3. 可用性

- [ ] 返回按鈕位置明顯
- [ ] 操作按鈕位置合理
- [ ] 搜尋框提示文字清楚
- [ ] 標籤意義明確

---

## ✅ 測試檢查清單

### 編譯與啟動
- [ ] TypeScript 編譯無錯誤
- [ ] 開發伺服器啟動成功
- [ ] 無控制台錯誤

### Phase 4.1: 佈局與導航
- [ ] 存取控制正常
- [ ] 頁首顯示正確
- [ ] 側邊導航完整
- [ ] 登出功能正常

### Phase 4.2: 儀表板
- [ ] API 回應正確
- [ ] 統計資料顯示
- [ ] 載入狀態正常
- [ ] 快速連結功能

### Phase 4.3: 公司管理
- [ ] 列表頁顯示正常
- [ ] 搜尋功能正常
- [ ] 篩選功能正常
- [ ] 詳情頁顯示完整
- [ ] 導航功能正常

### Phase 4.4: 使用者管理
- [ ] 列表頁顯示正常
- [ ] 搜尋功能正常
- [ ] 角色篩選正常
- [ ] 詳情頁顯示完整
- [ ] 導航功能正常

### 安全性
- [ ] 路由保護正常
- [ ] API 保護正常
- [ ] 資料隔離正確

### 響應式設計
- [ ] 桌面版正常
- [ ] 平板版正常
- [ ] 手機版正常

### 效能
- [ ] 載入速度合格
- [ ] 搜尋響應即時

### UI/UX
- [ ] 樣式一致
- [ ] 互動流暢
- [ ] 易於使用

---

## 🐛 已知問題

### 編譯警告
- `.next/types/validator.ts` 中的類型錯誤（Next.js 內部生成，不影響運行）
- 部分舊檔案的類型錯誤（不在 Phase 4 範圍內）

### 功能限制
- 權限管理頁面 (`/admin/permissions`) 尚未實作
- 系統統計頁面 (`/admin/analytics`) 尚未實作
- 系統設定頁面 (`/admin/settings`) 尚未實作
- 說明文件頁面 (`/admin/help`) 尚未實作

---

## 📊 測試結果記錄

測試日期: ___________
測試人員: ___________

| 測試項目 | 通過 | 失敗 | 備註 |
|---------|------|------|------|
| Phase 4.1 |  |  |  |
| Phase 4.2 |  |  |  |
| Phase 4.3 |  |  |  |
| Phase 4.4 |  |  |  |
| 安全性測試 |  |  |  |
| 響應式設計 |  |  |  |
| 效能測試 |  |  |  |
| UI/UX 測試 |  |  |  |

---

## 🎯 測試完成標準

Phase 4 視為完成，當:

1. ✅ 所有核心功能正常運作
2. ✅ 編譯無錯誤（admin 相關檔案）
3. ✅ 安全性檢查通過
4. ✅ 響應式設計正常
5. ✅ 無嚴重 UI 問題

---

## 📝 下一步

Phase 4 測試完成後，建議:

1. 更新 `CHANGELOG.md`
2. 建立 Phase 5 規劃（如需要）
3. 處理已知問題（如需要）
4. 準備生產環境部署

---

**測試愉快！** 🎉
